<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç®¡ç†è€…å ±è¡¨</title>
  <style>
    body {
      margin: 0;
      background: #f6f8fa;
      font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
      color: #1f2328;
    }
    .wrap {
      max-width: 1100px;
      margin: 20px auto;
      padding: 0 16px;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }
    .header h1 {
      margin: 0;
      font-size: 26px;
    }
    .export-btn {
      text-decoration: none;
      background: #3f8b56;
      color: #fff;
      border-radius: 8px;
      padding: 10px 14px;
      font-weight: 600;
      border: 0;
      cursor: pointer;
    }
    .export-btn:hover { background: #327046; }
    .pdf-btn {
      background: #c98980;
    }
    .pdf-btn:hover {
      background: #b4766d;
    }
    .toolbar { display: inline-flex; gap: 8px; align-items: center; }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(180px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }
    .summary-card {
      background: #fff;
      border: 1px solid #d8dee4;
      border-radius: 10px;
      padding: 12px;
    }
    .summary-title { color: #57606a; font-size: 13px; margin-bottom: 6px; }
    .summary-value { font-size: 24px; font-weight: 700; }

    .record {
      background: #fff;
      border: 1px solid #d8dee4;
      border-radius: 10px;
      margin-bottom: 12px;
      overflow: hidden;
    }
    .record-summary {
      cursor: pointer;
      padding: 12px 14px;
      background: #f6f8fa;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      flex-wrap: wrap;
      gap: 10px 18px;
      align-items: center;
      list-style: none;
    }
    .record-summary::-webkit-details-marker { display: none; }
    .tag {
      display: inline-flex;
      align-items: center;
      background: #eef6ff;
      border: 1px solid #cce1ff;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 12px;
    }
    .record-content {
      padding: 12px 14px;
      display: grid;
      gap: 14px;
    }
    .record-tools {
      display: flex;
      justify-content: flex-end;
    }
    .delete-one-btn {
      background: #cf222e;
      color: #fff;
      border: 0;
      border-radius: 8px;
      width: 34px;
      height: 34px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      line-height: 1;
    }
    .delete-one-btn:hover { background: #a40e26; }
    .section-title {
      margin: 0 0 8px;
      font-size: 16px;
    }
    .kv-grid {
      display: grid;
      grid-template-columns: 220px 1fr;
      gap: 8px 12px;
      align-items: start;
    }
    .k {
      color: #57606a;
      font-size: 13px;
      font-weight: 600;
      padding-top: 2px;
    }
    .v {
      white-space: pre-wrap;
      word-break: break-word;
      line-height: 1.45;
    }
    .empty {
      background: #fff;
      border: 1px dashed #c8d1dc;
      border-radius: 10px;
      padding: 18px;
      color: #57606a;
    }

    @media (max-width: 900px) {
      .summary-grid { grid-template-columns: 1fr; }
      .kv-grid { grid-template-columns: 1fr; }
      .header { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <h1>ç®¡ç†è€…å ±è¡¨ï½œ{{ survey_title }}</h1>
      <div class="toolbar">
        <a class="export-btn" href="{{ export_url }}">CSV</a>
        <a class="export-btn pdf-btn" href="{{ export_pdf_url }}">PDF</a>
      </div>
    </div>

    <div class="summary-grid">
      <div class="summary-card">
        <div class="summary-title">æäº¤ç¸½ç­†æ•¸</div>
        <div class="summary-value">{{ summary.total_submissions }}</div>
      </div>
      <div class="summary-card">
        <div class="summary-title">éƒ¨é–€æ•¸</div>
        <div class="summary-value">{{ summary.department_count }}</div>
      </div>
      <div class="summary-card">
        <div class="summary-title">æœ€æ–°æäº¤æ™‚é–“</div>
        <div class="summary-value" style="font-size: 18px;">{{ summary.latest_submitted_at }}</div>
      </div>
    </div>

    {% if records %}
      {% for record in records %}
      <details class="record" {% if loop.first %}open{% endif %}>
        <summary class="record-summary">
          <span class="tag">æäº¤æ™‚é–“ï¼š{{ record.submitted_at }}</span>
          <span class="tag">éƒ¨é–€ï¼š{{ record.department_name }}</span>
          <span class="tag">è¨ªè«‡äººå“¡ï¼š{{ record.person_name }}</span>
          <span class="tag">ä¸»æ¸¬ç³»çµ±ï¼š{{ record.main_system }}</span>
          <span class="tag">ä¸»æ¸¬è§’è‰²ï¼š{{ record.main_role }}</span>
        </summary>
        <div class="record-content">
          <div class="record-tools">
            <form method="post" action="{{ url_for('admin_report_delete_one', record_id=record.id) }}" data-department="{{ record.department_name }}" data-person="{{ record.person_name }}" onsubmit="return confirmDeleteRecord(this);">
              <button type="submit" class="delete-one-btn" aria-label="åˆªé™¤æ­¤ç­†è³‡æ–™" title="åˆªé™¤æ­¤ç­†è³‡æ–™">ğŸ—‘</button>
            </form>
          </div>
          <div>
            <h3 class="section-title">åŸºæœ¬è³‡æ–™</h3>
            <div class="kv-grid">
              {% for item in record.basic_items %}
              <div class="k">{{ item.label }}</div>
              <div class="v">{{ item.value }}</div>
              {% endfor %}
            </div>
          </div>

          <div>
            <h3 class="section-title">å•å·å…§å®¹</h3>
            <div class="kv-grid">
              {% for item in record.questionnaire_items %}
              <div class="k">{{ item.label }}</div>
              <div class="v">{{ item.value }}</div>
              {% endfor %}
            </div>
          </div>
        </div>
      </details>
      {% endfor %}
    {% else %}
      <div class="empty">ç›®å‰æ²’æœ‰æäº¤è³‡æ–™ï¼Œå¯å…ˆå¡«å¯«å•å·å¾Œå†æŸ¥çœ‹æ­¤é ã€‚</div>
    {% endif %}
  </div>

<script>
  function confirmDeleteRecord(formElement) {
    const department = formElement.dataset.department || 'æœªçŸ¥';
    const person = formElement.dataset.person || 'æœªçŸ¥';
    const message = `ç¢ºèªè¦åˆªé™¤æ­¤ ${department} éƒ¨é–€ ${person} äººå“¡çš„è³‡æ–™å—?`;
    return window.confirm(message);
  }
</script>
</body>
</html>
